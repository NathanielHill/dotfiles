if-shell 'test -z "$POWERLINE_CONFIG_COMMAND"' 'set-environment -g POWERLINE_CONFIG_COMMAND powerline-config'

source "/usr/local/lib/python3.5/dist-packages/powerline/bindings/tmux/powerline.conf"
run-shell -b "powerline-daemon -q; exit 0"
run-shell 'eval $POWERLINE_CONFIG_COMMAND tmux setup'

setw -g mode-keys vi
set -g bell-action any

# Speed up ESC behavior in Vim!
set -s escape-time 0

# colors
set -g default-terminal "screen-256color"

#set-window-option -g automatic-rename off

# force a reload of the config file
unbind r
bind r source-file ~/.tmux.conf

# Change pane swap keys
unbind x
bind x swap-pane -D

# quick pane cycling
unbind ^A
bind ^A select-pane -t :.+

# start window numbering at 1 for easier switching
set-option -g base-index 1
set-window-option -g pane-base-index 1

##########################################################
# The following is a trick for nested TMUX control!
# ########################################################

# remap prefix to Control + a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

set -g status-bg colour40
setw -g window-status-current-bg colour40

bind -n M-F11 set -qg status-bg colour25
bind -n M-F12 set -qg status-bg colour40

bind -n S-up \
         send-keys M-F12 \; \
         set -qg status-bg colour25 \; \
         unbind -n S-left \; \
         unbind -n S-right \; \
         unbind -n S-C-left \; \
         unbind -n S-C-right \; \
         unbind -n C-t \; \
         set -qg prefix C-b
         bind -n S-down \
             send-keys M-F11 \; \
             set -qg status-bg colour40 \; \
             bind -n S-left  prev \; \
             bind -n S-right next \; \
             bind -n S-C-left swap-window -t -1 \; \
             bind -n S-C-right swap-window -t +1 \; \
             bind -n C-t new-window -a -c "#{pane_current_path}" \; \
             set -qg prefix C-a
